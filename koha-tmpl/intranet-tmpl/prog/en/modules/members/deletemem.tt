[% USE raw %]
[% USE Asset %]
[% USE Price %]
[% USE Branches %]
[% SET footerjs = 1 %]
[% INCLUDE 'doc-head-open.inc' %]
<title>Delete patron [% patron.firstname | html %] [% patron.surname | html %] &rsaquo; Koha</title>
[% INCLUDE 'doc-head-close.inc' %]
</head>
<body id="pat_deletemem" class="pat">
[% WRAPPER 'header.inc' %]
    [% INCLUDE 'patron-search-header.inc' %]
[% END %]

[% WRAPPER 'sub-header.inc' %]
    [% WRAPPER breadcrumbs %]
        [% WRAPPER breadcrumb_item %]
            <a href="/cgi-bin/koha/members/members-home.pl">Patrons</a>
        [% END %]
        [% WRAPPER breadcrumb_item %]
            <a href="/cgi-bin/koha/members/moremember.pl?borrowernumber=[% patron.borrowernumber | uri %]">[% INCLUDE 'patron-title.inc' %]</a>
        [% END %]
        [% WRAPPER breadcrumb_item bc_active= 1 %]
            <span>Delete patron</span>
        [% END %]
    [% END #/ WRAPPER breadcrumbs %]
[% END #/ WRAPPER sub-header.inc %]

<div class="main container-fluid">
    <div class="row">
        <div class="col-sm-10 col-sm-push-2">
            <main>

    [% INCLUDE 'members-toolbar.inc' %]
    [% IF ItemsOnIssues || debits || is_guarantor %]
        <div class="dialog alert">
        <h1>Cannot delete patron</h1>
            <ul>
            [% IF ( ItemsOnIssues ) %]
                <li>Patron has [% ItemsOnIssues | html %] item(s) checked out.</li>
            [% END %]
            [% IF debits %]
                <li>Patron has [% debits | $Price %] in fines.</li>
            [% END %]
            [% IF is_guarantor %]
                <li>Patron's record has guaranteed accounts attached.</li>
            [% END %]
            </ul>
    </div>
    [% ELSIF op == 'delete_confirm' and patron %]
        [%# TODO add "patron does not exist" unless patron %]
        <div class="dialog alert">
            [% IF ItemsOnHold or credits or pending_suggestions > 0 %]
                <ul>
                    [% IF ItemsOnHold %]
                        <li>Patron has [% ItemsOnHold | html %] hold(s). Deleting patron cancels all their holds.</li>
                    [% END %]
                    [% IF credits %]
                        <li>Patron has a [% credits | $Price %] credit.</li>
                    [% END %]
                    [% IF pending_suggestions > 0 %]
                        <li>Patron has [% pending_suggestions | html %] pending suggestions.</li>
                    [% END %]
                </ul>
            [% END %]
            <h1>Are you sure you want to delete the patron [% patron.firstname | html %] [% patron.surname | html %]?</h1>
            <p>This cannot be undone.</p>
            <form action="/cgi-bin/koha/members/deletemem.pl">
                <input type="hidden" name="csrf_token" value="[% csrf_token | html %]" />
                <input type="hidden" name="member" value="[% patron.borrowernumber | html %]"/>
                <input type="hidden" name="op" value="delete_confirmed" />
                <button type="submit" class="approve"><i class="fa fa-fw fa-check"></i> Yes, delete</button>
            </form>
            <form action="/cgi-bin/koha/members/moremember.pl">
                <input type="hidden" name="borrowernumber" value="[% patron.borrowernumber | html %]"/>
                <button type="submit" class="deny"><i class="fa fa-fw fa-times"></i> No, do not delete</button>
            </form>
        </div>
    [% END %]

            </main>
        </div> <!-- /.col-sm-10.col-sm-push-2 -->

        <div class="col-sm-2 col-sm-pull-10">
            <aside>
                [% INCLUDE 'circ-menu.inc' %]
            </aside>
        </div> <!-- /.col-sm-2.col-sm-pull-10 -->
     </div> <!-- /.row -->

[% MACRO jsinclude BLOCK %]
    [% INCLUDE 'str/members-menu.inc' %]
    [% Asset.js("js/members-menu.js") | $raw %]
[% END %]

[% INCLUDE 'intranet-bottom.inc' %]

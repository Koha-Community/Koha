[% USE raw %]
[% PROCESS 'i18n.inc' %]
[% PROCESS 'html_helpers.inc' %]
[% INCLUDE 'doc-head-open.inc' %]
<title
    >[% FILTER collapse %]
        [% t("Add to your list") | html %]
        &rsaquo; [% PROCESS 'library_name_title' %]
    [% END %]</title
>
[% INCLUDE 'doc-head-close.inc' %]
[% BLOCK cssinclude %]
    <style>
        form {
            margin-left: 3rem;
        }
        .form-divider {
            background-color: #eee;
            border-bottom: 1px solid #d5d5d5;
            border-top: 1px solid #d5d5d5;
            margin: 0.5rem -1rem 0.5rem -1rem;
            padding: 0.5rem 2rem;
        }
    </style>
[% END %]
</head>
[% INCLUDE 'bodytag.inc' bodyid='addtolist' bodyclass='popup' %]
<nav class="navbar fixed-top">
    <div class="navbar-brand">
        [% IF ( newshelf ) %]
            <h1>Add to a new list</h1>
        [% ELSE %]
            [% IF ( multiple ) %]
                <h1>Add [% total | html %] items to [% IF ( singleshelf ) %]<em>[% shelfname | html %]</em>:[% ELSE %]<span>a list</span>[% END %]</h1>
            [% ELSE %]
                <h1>Add to [% IF ( singleshelf ) %]<em>[% shelfname | html %]</em>[% ELSE %]<span>a list</span>[% END %]</h1>
            [% END %]
        [% END %]
    </div>
    <ul class="navbar-nav">
        <li class="nav-item">
            <button type="button" class="btn-close close" aria-label="Close"></button>
        </li>
    </ul>
</nav>

<main class="main">
    <div class="container-fluid">
        <div class="row">
            <div class="col">
                <div id="add_to_list" class="maincontent">
                    [% IF ( authorized ) %]
                        <ul>
                            [% FOREACH biblio IN biblios %]
                                <li
                                    >[% INCLUDE 'biblio-title.inc' %]
                                    [% IF ( biblio.author ) %]<span class="author"> [% biblio.author | html %]</span>[% END %]
                                </li>
                            [% END %]
                        </ul>
                        [% UNLESS ( newshelf ) %]
                            [% IF private_shelves.count or public_shelves.count or private_shelves_shared_with_me.count %]
                                <form name="f1" action="/cgi-bin/koha/opac-addbybiblionumber.pl" method="post">
                                    [% INCLUDE 'csrf-token.inc' %]
                                    <fieldset>
                                        <legend>Select a list</legend>
                                        <div>
                                            <label class="form-label" for="shelfnumber">Add to list:</label>
                                            <select name="shelfnumber" id="shelfnumber" class="form-select">
                                                [% IF private_shelves.count %]
                                                    <optgroup label="Private lists">
                                                        [% FOREACH private_shelf IN private_shelves %]
                                                            <option value="[% private_shelf.shelfnumber | html %]">[% private_shelf.shelfname | html %]</option>
                                                        [% END %]
                                                    </optgroup>
                                                [% END %]
                                                [% IF private_shelves_shared_with_me.count %]
                                                    <optgroup label="Private lists shared with me">
                                                        [% FOREACH private_shelf IN private_shelves_shared_with_me %]
                                                            <option value="[% private_shelf.shelfnumber | html %]">[% private_shelf.shelfname | html %]</option>
                                                        [% END %]
                                                    </optgroup>
                                                [% END %]
                                                [% IF public_shelves.count %]
                                                    <optgroup label="Public lists">
                                                        [% FOREACH public_shelf IN public_shelves %]
                                                            <option value="[% public_shelf.shelfnumber | html %]">[% public_shelf.shelfname | html %]</option>
                                                        [% END %]
                                                    </optgroup>
                                                [% END %]
                                            </select>
                                            [% FOREACH biblio IN biblios %]
                                                <input type="hidden" name="biblionumber" value="[% biblio.biblionumber | html %]" />
                                            [% END %]
                                            <input type="hidden" name="op" value="cud-modifyshelfcontents" />
                                        </div>
                                    </fieldset>
                                    <fieldset class="action">
                                        <input type="submit" value="Save" class="btn btn-primary" />
                                        <a class="close cancel" href="#">Cancel</a>
                                    </fieldset>
                                </form>
                            [% ELSE %]
                                [% IF ( singleshelf ) %]
                                    <form name="f1" action="/cgi-bin/koha/opac-addbybiblionumber.pl" method="post" style="margin-left:0">
                                        [% INCLUDE 'csrf-token.inc' %]
                                        [% FOREACH biblio IN biblios %]
                                            <input type="hidden" name="biblionumber" value="[% biblio.biblionumber | html %]" />
                                        [% END %]
                                        <input type="hidden" name="shelfnumber" value="[% shelfnumber | html %]" />
                                        <input type="hidden" name="op" value="cud-modifyshelfcontents" />
                                        <fieldset class="action">
                                            <input type="submit" value="Save" class="btn btn-primary" />
                                            <a class="close cancel" href="#">Cancel</a>
                                        </fieldset>
                                    </form>
                                [% END %]
                            [% END # IF / existingshelves %]
                        [% END # / UNLESS newshelf %]
                    [% END # / IF authorized %]
                </div>
            </div>
        </div>
    </div>

    [% IF ( authorized && !newshelf && !singleshelf) %]
        [% #UNLESS ( newshelf ) %]
        [% #UNLESS ( singleshelf ) %]
        <div class="form-divider">...or...</div>
        [% #END %]
        [% #END %]
    [% END %]

    <div class="container-fluid">
        <div class="row">
            <div class="col">
                <div id="add_to_new_list" class="maincontent">
                    [% IF ( authorized ) %]
                        [% UNLESS ( singleshelf ) %]
                            <form name="f2" method="post" action="/cgi-bin/koha/opac-addbybiblionumber.pl">
                                [% INCLUDE 'csrf-token.inc' %]
                                <fieldset>
                                    <legend>Add to a new list:</legend>
                                    <div>
                                        <label for="newvirtualshelf" class="form-label required">List name:</label>
                                        <input type="text" name="newvirtualshelf" id="newvirtualshelf" size="40" class="form-control" required="required" />
                                    </div>
                                    <div>
                                        <label for="public" class="form-label">Category:</label>
                                        <select name="public" id="public" class="form-select">
                                            <option value="0">Private</option>
                                            [% IF (OpacAllowPublicListCreation) %]
                                                <option value="1">Public</option>
                                            [% END %]
                                        </select>
                                    </div>
                                </fieldset>
                                [% FOREACH biblio IN biblios %]
                                    <input type="hidden" name="biblionumber" value="[% biblio.biblionumber | html %]" />
                                [% END %]
                                <fieldset class="action">
                                    <input type="hidden" name="op" value="cud-add" />
                                    <input type="hidden" name="sortfield" value="title" />
                                    <input type="submit" value="Save" class="btn btn-primary" />
                                    <a class="close cancel" href="#">Cancel</a>
                                </fieldset>
                            </form>
                        [% END # / UNLESS singleshelf %]
                    [% ELSE %]
                        <p>
                            [% IF (errcode==1) %]
                                <span>Could not create new list. Please check if the name is unique.</span>
                            [% ELSE %]
                                <span>Sorry, you cannot add items to this list.</span>
                            [% END %]
                        </p>
                    [% END # IF authorized %]
                </div>
                <!-- / #useraddbybiblionumber -->
            </div>
            <!-- / .span12 -->
        </div>
        <!-- / .row -->
    </div>
    <!-- / .container-fluid -->
</main>
<!-- / .main -->

[% INCLUDE 'opac-bottom.inc' is_popup=1 %]
[% BLOCK jsinclude %]
    <script>
        $(document).ready(function() {
            [% IF WINDOW_PARENT_RELOAD %]
                opener.location.reload();
            [% END %]
            [% IF WINDOW_CLOSE %]
                window.close();
            [% END %]
        });
    </script>
[% END %]
